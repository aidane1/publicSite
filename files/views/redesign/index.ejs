    <!DOCTYPE html>
    <html lang="en" dir="ltr">
    <head>
    <meta name = "description" content = "The PVSS student website. View your courses, schedule, resources, and more here. Made by a PVSS student for PVSS students." />
    <meta charset = "utf-8">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0" />
    <meta name = "theme-color" content = "orange" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name = "apple-mobile-web-app-status-bar-style" content = "#FC7753">
    <meta name = "apple-mobile-web-app-title" content = "PVSS">
    <link rel = "manifest" href = "public/manifests/home.json  " />
    <link rel = "stylesheet" href = "/public/css/index.css">
    <title>PVSS student website | Home</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="icon" href="/public/schoolLogos/64x64_<%=favicon%>" type="image/x-icon">
    <link rel="shortcut icon" href="/public/schoolLogos/64x64_<%=favicon%>" type="image/x-icon">
    <link rel = "icon" sizes = "128x128" href = "/public/schoolLogos/128x128_<%=favicon%>" />
    <link rel = "icon" sizes = "192x192" href = "/public/schoolLogos/192x192_<%=favicon%>" />
    <link rel = "apple-touch-startup-image" href = "/public/schoolLogos/512x512_<%=favicon%>"/>
    <link rel = "apple-touch-icon" sizes = " 144x144" href = "/public/schoolLogos/144x144_<%=favicon%>" />
    <link rel = "apple-touch-icon" sizes = " 114x114" href = "/public/schoolLogos/114x114_<%=favicon%>" />
    <link rel = "apple-touch-icon" sizes = " 57x57" href = "/public/schoolLogos/57x57_<%=favicon%>" />
    <link rel = "apple-touch-icon" sizes = " 72x72" href = "/public/schoolLogos/72x72_<%=favicon%>" />
    <script>
        
    </script>
    <script>


    </script>
    <style>
        
    </style>
    </head>
    <body onunload="unload()">
        <div class="homeHolder" id = "homeHolder">
        <div class="homeHeader">
            <div class="homeRow">
                <div class="accountIcon" onclick = "window.location='/account'"><img src = "/public/icons/accountIcon.svg" /></div>
                <div class="displayText">Home</div>
                <div class="refreshIcon"></div>
            </div>
            <!-- <div class="homeTabView">
                <div class="tab" onclick = "moveTab(0)"><i class="fas fa-calendar-week"></i>Schedule</div>
                <div class="tab selectedTab" onclick = "moveTab(1)"><i class="fas fa-home"></i>Home</div>
                <div class="tab" onclick = "moveTab(2)"><i class="far fa-list-alt"></i>Courses</div>
                <div class="tab noBorder" onclick = "moveTab(3)"><i class="fas fa-calendar-alt"></i>Calendar</div>
            </div> -->
        </div>
        <div class = "backdrop" id = "backdrop">
            <div id = "scheduleTile" class="bodyTile">
                <div class="scheduleBodies">
                    <% for (var i = 0; i < readSchedule.length; i++) { %>
                        <div class="schedule">
                            <% for (var key in readSchedule[i]) { %>
                                <div class="scheduleDay">
                                    <div class="scheduleTitle">
                                        <%=titles[i][key]%>
                                    </div>
                                    <% for (var j = 0; j < readSchedule[i][key].length; j++) { %>
                                        <div class="scheduleBlock" style = "height: <%=readSchedule[i][key][j][2]%>px; background-color: <%=colorMap[readSchedule[i][key][j][0].block]%>">
                                            <div class="scheduleCourse"><%=readSchedule[i][key][j][0].course%></div>
                                            <% if (readSchedule[i][key][j][0].teacher != "Free") { %>
                                                <div class="scheduleTeacher"><%=readSchedule[i][key][j][0].teacher%></div>
                                            <% } %>
                                            <div class="scheduleTime"><%=readSchedule[i][key][j][1]%></div>
                                        </div>
                                    <% } %>
                                </div>
                            <% } %>
                        </div>
                    <% } %>
                </div>
            </div>
            <div id = "homeTile" href = "#homeTile" class="bodyTile">
                <div class="dayHeader" style="font-size: 40px">
                    <% if (today[1]) { %>
                        <%=titles[today[0][0]]["day" + (today[0][1]+1).toString()]%>    
                    <% } else { %>
                        Off! 
                    <% } %>
                    
                </div>
                <div class="eventsHolder">
                    <% for (var i = 0; i < soonEvents.length; i++) { %>
                        <div class="eventBlock"><%=soonEvents[i].time%> : <%=soonEvents[i].info%></div>
                    <% } %>
                    <% if (soonEvents.length == 0) { %>
                        <div class="eventBlock" style = "margin-top: 0; margin-bottom: 0">No Upcoming Events!</div>
                    <% } %>
                    
                </div>
                <div id="currentBlock" class = "blockHolder">
                    <div class="blockHeader">Current Class: </div>
                    <div class="classBlock">
                        <%=currentBlock[0]%> : <%=currentBlock[1].course%>
                    </div>
                </div>
                <div id="nextBlock" class = "block">
                    <div class="blockHeader">Next Class: </div>
                    <div class="classBlock"><%=nextBlock[0]%> : <%=nextBlock[1].course%></div>
                </div>
            </div>
            <div id = "coursesTile" class="bodyTile">
                <div class="dayTitle"><a href = "/courses" style = "text-decoration: none; color: black"><span style = "font-size: 12px; visibility: hidden">edit</span> Today <span style = "font-size: 12px">edit</span></a></div>
                <div class="dayHolder">
                    <% for (var i = 0; i < courses.length; i++) { %>
                        <% if (i == courses.length-1) { %>
                            <!-- <div class="dayBlock"> -->
                            <div class="dayBlock" onclick = "<%=courses[i][1].isReal ? `window.location='course?courseId=${courses[i][1]._id}'` : `` %>">
                                <div class="dayIcon">
                                    <div class="iconBubble" style = "background: <%=categories[courses[i][1].category.category.toLowerCase()] ? categories[courses[i][1].category.category.toLowerCase()][1] : categories['other'][1]%>">
                                        <%-categories[courses[i][1].category.category.toLowerCase()] ? categories[courses[i][1].category.category.toLowerCase()][0] : categories['other'][0]%>
                                    </div>
                                </div>
                                <div class="bottomClass">
                                    <div class="teacherClassBlock">
                                        <div class="className"><%=courses[i][1].course%></div>
                                        <div class="teacherName"><%=courses[i][1].teacher%></div>
                                    </div>
                                    <div class="timeBlock">
                                        <%=courses[i][0]%>
                                        <%- courses[i][1].isReal ? '<i class="fas fa-chevron-right"></i>' : ""%>
                                    </div>
                                </div>
                            </div>
                        <% } else { %>
                            <!-- <div class="dayBlock"> -->
                            <div class="dayBlock" onclick = "<%=courses[i][1].isReal ? `window.location='course?courseId=${courses[i][1]._id}'` : `` %>">
                                <div class="dayIcon">
                                        <div class="iconBubble" style = "background-color: <%=categories[courses[i][1].category.category.toLowerCase()] ? categories[courses[i][1].category.category.toLowerCase()][1] : categories['other'][1]%>">
                                        <%-categories[courses[i][1].category.category.toLowerCase()] ? categories[courses[i][1].category.category.toLowerCase()][0] : categories['other'][0]%>
                                    </div>
                                </div>
                                <div class="dayClass">
                                    <div class="teacherClassBlock">
                                        <div class="className"><%=courses[i][1].course%></div>
                                        <div class="teacherName"><%=courses[i][1].teacher%></div>
                                    </div>
                                    <div class="timeBlock">
                                        <%=courses[i][0]%>
                                        <%- courses[i][1].isReal ? '<i class="fas fa-chevron-right"></i>' : ""%>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    <% } %>
                </div>
            </div>
            <div id = "calendarTile" class="bodyTile">
                <div class="calendarBodies" id = "calendarBodies">
                    <%let initialOffset = offset%>
                    <% for (var i = 0; i < monthLengths.length; i++) { %>
                        <% let currentMonth = (new Date(startDate[0], startDate[1]+i, 1)).getMonth()%>
                        <% let pastDue = true%>
                        <div class="calendarDate" id = "<%=monthNames[i].split(' ').join('_')%>" >
                            <div class="middleBar"></div>
                            <div class="dateName">
                                <%=monthNames[i]%>
                            </div>
                            <div class="middleBar"></div>
                        </div>
                        <div class="calendarTile" month="<%=monthNames[i]%>"href = "#<%=monthNames[i].split(' ').join('_')%>">
                            <% for (var j = 0; j < 6; j++) { %>
                                <div class="calendarRow">
                                    <% for (var k = 0; k < 7; k++) { %>
                                        <% if (j*7 + k >= initialOffset) { %>
                                            <% let previousDate = new Date(startDate[0], startDate[1] + i, startDate[2] + 7*j+k-initialOffset-1)%>
                                            <% let todayDate = new Date(startDate[0], startDate[1] + i, startDate[2] + 7*j+k-initialOffset)%>
                                            <% if (todayDate.getMonth() > currentMonth || (currentMonth == 11 && todayDate.getMonth() == 0)) { %>
                                                <div class="calendarDay empty">
                                                    <div class="dayDate">
                                                        <%= todayDate.getDate()%>
                                                    </div>
                                                    <div class="boxTitle">
        
                                                    </div>
                                                    <div class="dayEvent" style = "visibility: hidden">
        
                                                    </div>
                                                </div>
                                            <% }  else { %>
                                                <% let today = eventMap[`${todayDate.getFullYear()}_${todayDate.getMonth()}_${todayDate.getDate()}`]; %>
                                                <% if (today) { %>
                                                    <% let events = [] %>
                                                    <% for (var l = 0; l < today[3].length; l++) { %>
                                                        <% events.push({time: today[3][l].time, info: today[3][l].info}); %>
                                                    <% } %>
                                                    <div class="calendarDay" onclick = "extendCalendarPopup('<%=moment([todayDate.getFullYear(), todayDate.getMonth(), todayDate.getDate()]).format('MMMM D, YYYY')%>', '<%=JSON.stringify(events)%>')">
                                                        <div class="dayDate">
                                                            <%= todayDate.getDate()%>
                                                        </div>
                                                        <div class="boxTitle">
                                                            <%= today[1] ? titles[today[0][0]]["day" + (today[0][1]+1).toString()] : ""%>
                                                        </div>
                                                        <div class="dayEvent" style = "visibility: <%=today[2] ? 'visible' : 'hidden'%>">
                                                            
                                                        </div>
                                                    </div>
                                                <% } else { %>
                                                    <div class="calendarDay empty" onclick = "extendCalendarPopup('<%=moment([todayDate.getFullYear(), todayDate.getMonth(), todayDate.getDate()]).format('MMMM D, YYYY')%>', [])">
                                                        <div class="dayDate">
                                                            <%= todayDate.getDate()%>
                                                        </div>
                                                        <div class="boxTitle">
            
                                                        </div>
                                                        <div class="dayEvent" style = "visibility: hidden">
            
                                                        </div>
                                                    </div>
                                                <% } %>
                                            <% } %>
                                        <% } else { %>
                                            <div class="calendarDay empty">
                                                <div class="dayDate">
                                                    <% let oldDate = new Date(startDate[0], startDate[1]+i, 0) %>
                                                    <%= oldDate.getDate()-initialOffset+j*7+k+1%>
                                                </div>
                                                <div class="boxTitle">

                                                </div>
                                                <div class="dayEvent" style = "visibility: hidden">

                                                </div>
                                            </div>
                                        <% } %>
                                    <% } %>
                                </div>    
                            <% } %>
                        </div>
                        <% initialOffset = (initialOffset + monthLengths[i])%7%>
                    <% } %>
                </div>
                <div class="calendarPopUp" id = "calendarPopUp">
                    <div class="removePopUp" onclick = "removePopUp()"></div>
                    <div class="dateTitle" id = "dateTitle"></div>
                    <div id = "eventsHolder"></div>
                </div>
            </div>
        </div>
        <div class="bottomTabBar">
                <div class="homeTabView">
                    <div class="tab" onclick = "moveTab(0)"><i class="fas fa-calendar-week"></i>Schedule</div>
                    <div class="tab selectedTab" onclick = "moveTab(1)"><i class="fas fa-home"></i>Home</div>
                    <div class="tab" onclick = "moveTab(2)"><i class="far fa-list-alt"></i>Courses</div>
                    <div class="tab noBorder" onclick = "moveTab(3)"><i class="fas fa-calendar-alt"></i>Calendar</div>
                </div>
        </div>
    </div>
    <% if (alert) { %> 
        <% if (alert[0]) { %>
            <div class="alert" id = "shown" onclick = "removeAlert(); window.location = '<%=alert[0]%>'">
                <Strong>Notice:</Strong> <%=alert[1]%>
            </div>
        <% } else { %>
            <div class="alert" id = "shown">
                <Strong>Notice:</Strong> <%=alert[1]%>
            </div>
        <% } %>
        
    <% } %>
    
  </body>
  <script>
    function removeAlert() {
        var request = new XMLHttpRequest();
        request.open('GET', '/removeAlert', true);
        request.send(null);
    }
    function unload() {
        var request = new XMLHttpRequest();
        request.open('GET', '/monitorUsage?page=/&id=<%=userId%>', true);
        request.send(null);
    }
    function extendCalendarPopup(dateString, events) {
// 
        

        events = JSON.parse(events);
        
        let popup = document.getElementById("calendarPopUp");
        popup.style.top = "50px";
        var myNode = document.getElementById("eventsHolder");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }
        for (var i = 0; i < events.length; i++) {
            let event = document.createElement("div");
            event.className = "eventBody";
            let time = document.createElement("div");
            time.className = "eventBodyTime";
            let info = document.createElement("div");
            info.className = "eventBodyInfo";
            time.innerHTML = events[i].time;
            info.innerHTML = events[i].info;
            event.appendChild(time);
            event.appendChild(info);
            myNode.appendChild(event);
        }
        if (events.length == 0) {
            let event = document.createElement("div");
            event.className = "eventBody";
            let time = document.createElement("div");
            time.className = "eventBodyTime";
            let info = document.createElement("div");
            info.className = "eventBodyInfo";
            time.innerHTML = "";
            info.innerHTML = "No Events!";
            event.appendChild(time);
            event.appendChild(info);
            myNode.appendChild(event);
        }
        document.getElementById("dateTitle").innerHTML = dateString;
    }
    function removePopUp() {
        let popup = document.getElementById("calendarPopUp");
        popup.style.top = "calc(100% + 20px)";
    }
    let currentBodyIndex = 1;
    let backdrop = document.getElementById("backdrop");
    let bodies = document.getElementById("calendarBodies");
    let width = window.innerWidth;
    backdrop.addEventListener("touchend", function(touch) {
        
    });
    function moveTab(index) {
        let tabs = document.getElementsByClassName("tab");
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove("selectedTab");
            if (i == index) {
                tabs[i].classList.add("selectedTab");
            }
        }
        $("#backdrop").animate({scrollLeft: index*width}, 200);
    }
    backdrop.addEventListener("touchmove", function(touch) {
        let currentBody = Math.round(backdrop.scrollLeft/width);
        if (currentBody != currentBodyIndex) {
            currentBodyIndex = currentBody;
            let tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("selectedTab");
                if (i == currentBodyIndex) {
                    tabs[i].classList.add("selectedTab");
                }
            }
        }
    });

    document.onclick = function() {
        let shownAlerts = document.getElementById("shown");
        if (shownAlerts && shownAlerts.style.top == "20%") {
            removeAlert();
            shownAlerts.style.top = "-200px";
        }
    }
    window.onload = function() {
        let currentMonth = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][new Date().getMonth()];
        let calendar = document.getElementById(currentMonth + "_" + new Date().getFullYear().toString());
        calendar.scrollIntoView();
        backdrop.scrollLeft = window.innerWidth;
        $("#calendarBodies").animate({scrollLeft: Math.round(4)*(width)}, 100);
        let shownAlerts = document.getElementById("shown");
        if (shownAlerts) {
            shownAlerts.style.top = "20%";    
        }
        
    }
  </script>
</html>
